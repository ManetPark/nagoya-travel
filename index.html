<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4F46E5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ÎÇòÍ≥†Ïïº">
    <title>ÎÇòÍ≥†Ïïº Ïó¨Ìñâ Î©îÏù¥Ìä∏</title>
    
    <!-- ÏïÑÏù¥ÏΩò ÏÑ§Ï†ï -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        input[type='number']::-webkit-inner-spin-button, input[type='number']::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Chat Bubble Animation */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        /* Modal Overlay */
        .modal-overlay { background-color: rgba(0, 0, 0, 0.5); }
        
        /* iOS Safe Area */
        @supports(padding: env(safe-area-inset-bottom)) {
            .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Service Worker Îì±Î°ù
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }

        // ========== IndexedDB Ïú†Ìã∏Î¶¨Ìã∞ Ìï®Ïàò ==========
        const DB_NAME = 'NagoyaTravelDB';
        const DB_VERSION = 2;
        const STORE_EXPENSES = 'expenses';
        const STORE_ITINERARY = 'itinerary';

        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    
                    if (!db.objectStoreNames.contains(STORE_EXPENSES)) {
                        db.createObjectStore(STORE_EXPENSES, { keyPath: 'id' });
                    }
                    
                    if (!db.objectStoreNames.contains(STORE_ITINERARY)) {
                        db.createObjectStore(STORE_ITINERARY, { keyPath: 'id' });
                    }
                };
            });
        };

        const saveToStore = async (storeName, items) => {
            try {
                const db = await initDB();
                const transaction = db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                store.clear();
                items.forEach(item => store.add(item));
                
                return new Promise((resolve, reject) => {
                    transaction.oncomplete = () => resolve(true);
                    transaction.onerror = () => reject(transaction.error);
                });
            } catch (error) {
                console.error('Failed to save:', error);
                return false;
            }
        };

        const loadFromStore = async (storeName) => {
            try {
                const db = await initDB();
                const transaction = db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            } catch (error) {
                console.error('Failed to load:', error);
                return [];
            }
        };

        // Lucide Icons
        const Calendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const MapPin = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>;
        const Wallet = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>;
        const Languages = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path></svg>;
        const ChevronDown = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>;
        const ChevronUp = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>;
        const Coffee = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>;
        const Utensils = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></svg>;
        const ShoppingBag = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>;
        const Train = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2"></rect><path d="M4 11h16"></path><path d="M12 4v7"></path><path d="m8 19-2 3"></path><path d="m18 22-2-3"></path><path d="M8 15h0"></path><path d="M16 15h0"></path></svg>;
        const Hotel = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z"></path><path d="m9 16 .348-.24c1.465-1.013 3.84-1.013 5.304 0L15 16"></path><path d="M8 7h.01"></path><path d="M16 7h.01"></path><path d="M12 7h.01"></path><path d="M12 11h.01"></path><path d="M16 11h.01"></path><path d="M8 11h.01"></path></svg>;
        const Plus = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Trash2 = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const Edit = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
        const X = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;
        const Volume2 = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>;
        const ArrowRight = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>;
        const Globe = ({size = 18}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>;
        const Sparkles = ({size = 20, className = ""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>;
        const User = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
        const Database = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;
        const Save = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>;

        // ÏïÑÏù¥ÏΩò Îß§Ìïë
        const iconMap = {
            'train': Train,
            'hotel': Hotel,
            'utensils': Utensils,
            'mappin': MapPin,
            'shoppingbag': ShoppingBag,
            'coffee': Coffee
        };

        // Gemini API
        const callGeminiAPI = async (userQuery) => {
            const apiKey = "AIzaSyBn7yNPDQu5KWbrtgLVlvgCwgHQwFUTdBU";
            
            if (!apiKey || apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                return "‚ö†Ô∏è API ÌÇ§Í∞Ä ÏÑ§Ï†ïÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§.\n\nÏΩîÎìúÏùò callGeminiAPI Ìï®ÏàòÏóêÏÑú apiKeyÎ•º ÏÑ§Ï†ïÌï¥Ï£ºÏÑ∏Ïöî.\n\nGoogle AI Studio(https://aistudio.google.com/app/apikey)ÏóêÏÑú Î¨¥Î£åÎ°ú Î∞úÍ∏âÎ∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§.";
            }
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`;
            const systemInstruction = "ÎãπÏã†ÏùÄ ÎÇòÍ≥†Ïïº Ïó¨Ìñâ Ï†ÑÎ¨∏Í∞Ä Í∞ÄÏù¥Îìú 'ÎÇòÍ≥†Ïïº Î©îÏù¥Ìä∏'ÏûÖÎãàÎã§. ÌïúÍµ≠Ïù∏ Ïó¨ÌñâÍ∞ùÏóêÍ≤å ÏπúÏ†àÌïòÍ≥† Ïú†Ïö©Ìïú Ï†ïÎ≥¥Î•º Ï†úÍ≥µÌïòÏÑ∏Ïöî. ÎãµÎ≥ÄÏùÄ Î™®Î∞îÏùº ÌôîÎ©¥ÏóêÏÑú Î≥¥Í∏∞ Ï¢ãÍ≤å 3Ï§Ñ Ïù¥ÎÇ¥Î°ú ÌïµÏã¨Îßå ÏöîÏïΩÌï¥ÏÑú ÎßêÌïòÍ≥†, ÌïÑÏöîÌïòÎ©¥ Ïù¥Î™®ÏßÄÎ•º ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API Error: ${response.status}`);
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "ÎãµÎ≥ÄÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏñ¥Ïöî.";
            } catch (error) {
                return `ÎÑ§Ìä∏ÏõåÌÅ¨ Ïò§Î•ò: ${error.message}`;
            }
        };

        // Í∏∞Î≥∏ ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞
        const defaultItinerary = [
            {
                id: 1,
                day: 1,
                date: "1Ïõî 31Ïùº (Í∏à)",
                title: "ÎÇòÍ≥†Ïïº ÎèÑÏ∞© & ÏÇ¨Ïπ¥Ïóê ÌÉêÎ∞©",
                location: "ÎÇòÍ≥†Ïïº ÏãúÎÇ¥",
                activities: [
                    { id: 101, time: "10:00", title: "ÎÇòÍ≥†Ïïº Ï£ºÎ∂Ä Í≥µÌï≠ ÎèÑÏ∞©", desc: "ÎÆ§Ïä§Ïπ¥Ïù¥ Ïó¥Ï∞® ÌÉëÏäπ", icon: "train" },
                    { id: 102, time: "12:00", title: "Ìò∏ÌÖî Ï≤¥ÌÅ¨Ïù∏", desc: "ÎÇòÍ≥†ÏïºÏó≠ Í∑ºÏ≤ò", icon: "hotel" },
                    { id: 103, time: "13:00", title: "Ï†êÏã¨: ÎØ∏ÏÜåÏπ¥Ï∏†", desc: "ÏïºÎ∞îÌÜ§ Î™ÖÎ¨º", icon: "utensils" },
                    { id: 104, time: "15:00", title: "ÎÇòÍ≥†Ïïº ÏÑ±", desc: "Ï≤úÏàòÍ∞Å Í¥ÄÎûå", icon: "mappin" },
                    { id: 105, time: "18:00", title: "ÏÇ¨Ïπ¥Ïóê ÏßÄÍµ¨", desc: "Ïò§ÏïÑÏãúÏä§21 ÏïºÍ≤Ω", icon: "shoppingbag" },
                    { id: 106, time: "20:00", title: "Ï†ÄÎÖÅ: ÌÖåÎ∞îÏÇ¨ÌÇ§", desc: "ÏÑ∏Ïπ¥Ïù¥ÎÖ∏ ÏïºÎßàÏß±", icon: "utensils" }
                ]
            }
            {
                id: 2,
                day: 2,
                date: "2Ïõî 1Ïùº (ÌÜ†)",
                title: "Í∑ºÍµê Ïó¨Ìñâ: Îã§Ïπ¥ÏïºÎßà & Í≤åÎ°ú",
                location: "Îã§Ïπ¥ÏïºÎßà / Í≤åÎ°ú",
                activities: [
                    { time: "08:00", title: "ÌûàÎã§ ÏôÄÏù¥ÎìúÎ∑∞ Ïó¥Ï∞® ÌÉëÏäπ", desc: "ÎÇòÍ≥†ÏïºÏó≠ -> Îã§Ïπ¥ÏïºÎßàÏó≠ (ÏïΩ 2ÏãúÍ∞Ñ 20Î∂Ñ)", icon: "train" },
                    { time: "11:00", title: "Îã§Ïπ¥ÏïºÎßà ÏòõÍ±∞Î¶¨ (ÏÇ∞ÎßàÏπò)", desc: "ÏûëÏùÄ ÍµêÌÜ†Îùº Î∂àÎ¶¨Îäî Í±∞Î¶¨ ÏÇ∞Ï±Ö", icon: "mappin" },
                    { time: "12:30", title: "Ï†êÏã¨: ÌûàÎã§Í∑ú Ïä§Ïãú/Íµ¨Ïù¥", desc: "ÏûÖÏóêÏÑú ÎÖπÎäî ÏÜåÍ≥†Í∏∞ ÏöîÎ¶¨", icon: "utensils" },
                    { time: "15:00", title: "Í≤åÎ°ú Ïò®Ï≤úÏúºÎ°ú Ïù¥Îèô", desc: "JR Ïó¥Ï∞®Î°ú ÏïΩ 45Î∂Ñ Ïù¥Îèô", icon: "train" },
                    { time: "17:00", title: "Î£åÏπ∏ Ï≤¥ÌÅ¨Ïù∏ & Ïò®Ï≤ú", desc: "ÏùºÎ≥∏ 3ÎåÄ Ïò®Ï≤ú Ï¶êÍ∏∞Í∏∞", icon: "hotel" },
                    { time: "19:00", title: "Í∞ÄÏù¥ÏÑ∏ÌÇ§ ÏÑùÏãù", desc: "Î£åÏπ∏ ÎÇ¥ Ï†ÄÎÖÅ ÏãùÏÇ¨", icon: "utensils" }
                ]
            }
            {
                id: 3,
                day: 3,
                date: "2Ïõî 2Ïùº (Ïùº)",
                title: "ÎÇòÍ≥†Ïïº Î≥µÍ∑Ä & Ïò§Ïä§ ÏÉÅÏ†êÍ∞Ä",
                location: "Í≤åÎ°ú / ÎÇòÍ≥†Ïïº",
                activities: [
                    { time: "09:00", title: "Ï°∞Ïãù ÌõÑ Ï≤¥ÌÅ¨ÏïÑÏõÉ", desc: "Í≤åÎ°ú Ïò®Ï≤úÎßàÏùÑ ÏÇ∞Ï±Ö Î∞è Ï°±Ïöï", icon: "coffee" },
                    { time: "11:00", title: "ÎÇòÍ≥†ÏïºÌñâ Ïó¥Ï∞® ÌÉëÏäπ", desc: "ÎÇòÍ≥†ÏïºÏó≠ Î≥µÍ∑Ä (ÏïΩ 1ÏãúÍ∞Ñ 40Î∂Ñ)", icon: "train" },
                    { time: "13:30", title: "Ï†êÏã¨: ÌûàÏ∏†ÎßàÎ∂ÄÏãú", desc: "ÏïÑÏ∏†ÌÉÄ Ìò∏ÎùºÏù¥ÏºÑ Îì± Ïû•Ïñ¥ÎçÆÎ∞•", icon: "utensils" },
                    { time: "15:30", title: "Ïò§Ïä§ Ïπ∏ÎÖº & ÏÉÅÏ†êÍ∞Ä", desc: "ÎπàÌã∞ÏßÄ ÏÉµ, Í∏∏Í±∞Î¶¨ ÏùåÏãù ÌÉêÎ∞©", icon: "shoppingbag" },
                    { time: "19:00", title: "ÎÇòÍ≥†ÏïºÏó≠ Ï£ºÎ≥Ä ÏáºÌïë", desc: "Îã§Ïπ¥ÏãúÎßàÏïº Î∞±ÌôîÏ†ê, ÎìúÎü≠Ïä§ÌÜ†Ïñ¥", icon: "shoppingbag" }
                ]
            }
            {
                day: 4,
                date: "2Ïõî 3Ïùº (Ïõî)",
                title: "Î™®Îãù & Í∑ÄÍµ≠",
                location: "ÎÇòÍ≥†Ïïº",
                activities: [
                    { time: "09:00", title: "ÎÇòÍ≥†Ïïº Î™®Îãù", desc: "ÏΩîÎ©îÎã§ Ïª§ÌîºÏóêÏÑú ÏùåÎ£å Ï£ºÎ¨∏Ïãú ÌÜ†Ïä§Ìä∏ Î¨¥Î£å", icon: "coffee" },
                    { time: "11:00", title: "ÎÖ∏Î¶¨ÌÉÄÏºÄÏùò Ïà≤", desc: "ÎèÑÏûêÍ∏∞ Ï†ïÏõê ÏÇ∞Ï±Ö Î∞è Í∏∞ÎÖêÌíà", icon: "mappin" },
                    { time: "13:00", title: "Í≥µÌï≠ÏúºÎ°ú Ïù¥Îèô", desc: "ÎπÑÌñâÍ∏∞ ÏãúÍ∞ÑÏóê ÎßûÏ∂∞ ÎÆ§Ïä§Ïπ¥Ïù¥ ÌÉëÏäπ", icon: "train" },
                    { time: "15:00", title: "Î©¥ÏÑ∏Ï†ê ÏáºÌïë & Ï∂úÍµ≠", desc: "Î°úÏù¥Ï¶à Ï¥àÏΩúÎ¶ø, ÎèÑÏøÑ Î∞îÎÇòÎÇò Îì±", icon: "shoppingbag" }
                ]
            }
        ];

        // ÌöåÌôî Îç∞Ïù¥ÌÑ∞
        const phrases = [
            { k: "ÏïàÎÖïÌïòÏÑ∏Ïöî", j: "„Åì„Çì„Å´„Å°„ÅØ", r: "Í≥§ÎãàÏ∞åÏôÄ" },
            { k: "Í∞êÏÇ¨Ìï©ÎãàÎã§", j: "„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô", r: "ÏïÑÎ¶¨Í∞ÄÎòê-Í≥†ÏûêÏù¥ÎßàÏä§" },
            { k: "ÌôîÏû•Ïã§ÏùÄ Ïñ¥ÎîîÏù∏Í∞ÄÏöî?", j: "„Éà„Ç§„É¨„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü", r: "ÌÜ†Ïù¥Î†àÏôÄ ÎèÑÏΩîÎç∞Ïä§Íπå?" },
            { k: "Ïù¥Í≤ÉÏùÄ ÏñºÎßàÏûÖÎãàÍπå?", j: "„Åì„Çå„ÅØ„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü", r: "Í≥†Î†àÏôÄ Ïù¥Ïø†ÎùºÎç∞Ïä§Íπå?" },
            { k: "Ï£ºÎ¨∏ Î∂ÄÌÉÅÌï©ÎãàÎã§", j: "Ê≥®Êñá„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô", r: "Ï∂î-Î™¨Ïò§ Ïò§ÎÑ§Í∞ÄÏù¥ÏãúÎßàÏä§" },
            { k: "Í≥ÑÏÇ∞Ìï¥ Ï£ºÏÑ∏Ïöî", j: "„Åä‰ºöË®à„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô", r: "Ïò§Ïπ¥Ïù¥ÏºÄ-Ïò§ Ïò§ÎÑ§Í∞ÄÏù¥ÏãúÎßàÏä§" },
        ];

        // Components
        const Navigation = ({ activeTab, setActiveTab }) => (
            <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 pb-safe z-50 h-16 flex justify-around items-center shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                <button onClick={() => setActiveTab('itinerary')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'itinerary' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <Calendar />
                    <span className="text-[10px] mt-1 font-medium">ÏùºÏ†ï</span>
                </button>
                <button onClick={() => setActiveTab('ai-guide')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'ai-guide' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <Sparkles size={20} />
                    <span className="text-[10px] mt-1 font-medium">AI Í∞ÄÏù¥Îìú</span>
                </button>
                <button onClick={() => setActiveTab('translate')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'translate' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <Languages />
                    <span className="text-[10px] mt-1 font-medium">Î≤àÏó≠</span>
                </button>
                <button onClick={() => setActiveTab('wallet')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'wallet' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <Wallet />
                    <span className="text-[10px] mt-1 font-medium">ÏßÄÏ∂ú</span>
                </button>
            </nav>
        );

        const Header = ({ title }) => (
            <header className="fixed top-0 left-0 right-0 bg-indigo-600 text-white h-14 flex items-center justify-center px-4 z-50 shadow-md">
                <h1 className="text-lg font-bold tracking-wide">{title}</h1>
            </header>
        );

        // ÏùºÏ†ï Ìé∏Ïßë Î™®Îã¨
        const EditActivityModal = ({ activity, onSave, onClose, dayNum }) => {
            const [formData, setFormData] = useState(activity || {
                time: "",
                title: "",
                desc: "",
                icon: "mappin"
            });

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    ...formData,
                    id: activity?.id || Date.now()
                });
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-end justify-center modal-overlay" onClick={onClose}>
                    <div className="bg-white rounded-t-3xl w-full max-w-md p-6 animate-fade-in" onClick={(e) => e.stopPropagation()}>
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-bold text-gray-800">
                                {activity ? 'ÏùºÏ†ï ÏàòÏ†ï' : 'ÏùºÏ†ï Ï∂îÍ∞Ä'}
                            </h3>
                            <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
                                <X size={24} />
                            </button>
                        </div>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ÏãúÍ∞Ñ</label>
                                <input
                                    type="time"
                                    value={formData.time}
                                    onChange={(e) => setFormData({...formData, time: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Ï†úÎ™©</label>
                                <input
                                    type="text"
                                    value={formData.title}
                                    onChange={(e) => setFormData({...formData, title: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    placeholder="Ïòà: ÎÇòÍ≥†Ïïº ÏÑ±"
                                    required
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ÏÑ§Î™Ö</label>
                                <input
                                    type="text"
                                    value={formData.desc}
                                    onChange={(e) => setFormData({...formData, desc: e.target.value})}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    placeholder="Ïòà: Ï≤úÏàòÍ∞Å Í¥ÄÎûå"
                                />
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">ÏïÑÏù¥ÏΩò</label>
                                <div className="grid grid-cols-6 gap-2">
                                    {Object.keys(iconMap).map(iconKey => {
                                        const IconComponent = iconMap[iconKey];
                                        return (
                                            <button
                                                key={iconKey}
                                                type="button"
                                                onClick={() => setFormData({...formData, icon: iconKey})}
                                                className={`p-3 rounded-lg border-2 flex items-center justify-center ${formData.icon === iconKey ? 'border-indigo-600 bg-indigo-50' : 'border-gray-200'}`}
                                            >
                                                <IconComponent size={20} />
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>

                            <div className="flex gap-2 pt-2">
                                <button
                                    type="button"
                                    onClick={onClose}
                                    className="flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium"
                                >
                                    Ï∑®ÏÜå
                                </button>
                                <button
                                    type="submit"
                                    className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium"
                                >
                                    Ï†ÄÏû•
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            );
        };

        // ÏùºÏ†ï Î∑∞
        const ItineraryView = () => {
            const [itinerary, setItinerary] = useState([]);
            const [expandedDay, setExpandedDay] = useState(1);
            const [editingActivity, setEditingActivity] = useState(null);
            const [editingDay, setEditingDay] = useState(null);
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const loadData = async () => {
                    const loaded = await loadFromStore(STORE_ITINERARY);
                    setItinerary(loaded.length > 0 ? loaded : defaultItinerary);
                    setIsLoading(false);
                };
                loadData();
            }, []);

            useEffect(() => {
                if (!isLoading && itinerary.length > 0) {
                    saveToStore(STORE_ITINERARY, itinerary);
                }
            }, [itinerary, isLoading]);

            const handleSaveActivity = (dayId, activityData) => {
                setItinerary(prev => prev.map(day => {
                    if (day.id === dayId) {
                        const existingIndex = day.activities.findIndex(a => a.id === activityData.id);
                        if (existingIndex >= 0) {
                            const newActivities = [...day.activities];
                            newActivities[existingIndex] = activityData;
                            return {...day, activities: newActivities};
                        } else {
                            return {...day, activities: [...day.activities, activityData]};
                        }
                    }
                    return day;
                }));
                setEditingActivity(null);
                setEditingDay(null);
            };

            const handleDeleteActivity = (dayId, activityId) => {
                if (confirm('Ïù¥ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                    setItinerary(prev => prev.map(day => {
                        if (day.id === dayId) {
                            return {...day, activities: day.activities.filter(a => a.id !== activityId)};
                        }
                        return day;
                    }));
                }
            };

            if (isLoading) {
                return (
                    <div className="pb-20 pt-16 px-4 h-full flex items-center justify-center">
                        <div className="text-center">
                            <Database size={48} className="mx-auto text-indigo-600 mb-3 animate-pulse" />
                            <p className="text-gray-500">ÏùºÏ†ï Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="pb-20 pt-16 px-4 space-y-4">
                    {itinerary.map((dayInfo) => (
                        <div key={dayInfo.id} className="bg-white rounded-xl overflow-hidden card-shadow">
                            <button 
                                onClick={() => setExpandedDay(expandedDay === dayInfo.day ? null : dayInfo.day)}
                                className={`w-full flex items-center justify-between p-4 ${expandedDay === dayInfo.day ? 'bg-indigo-50' : 'bg-white'}`}
                            >
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${expandedDay === dayInfo.day ? 'bg-indigo-600' : 'bg-gray-400'}`}>
                                        Day {dayInfo.day}
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-gray-800">{dayInfo.date}</div>
                                        <div className="text-xs text-gray-500">{dayInfo.location}</div>
                                    </div>
                                </div>
                                {expandedDay === dayInfo.day ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>
                            
                            {expandedDay === dayInfo.day && (
                                <div className="p-4 border-t border-gray-100 bg-white">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="font-bold text-indigo-800 text-sm">{dayInfo.title}</h3>
                                        <button
                                            onClick={() => {
                                                setEditingDay(dayInfo.id);
                                                setEditingActivity(null);
                                            }}
                                            className="flex items-center gap-1 px-3 py-1 bg-indigo-600 text-white rounded-lg text-xs"
                                        >
                                            <Plus size={14} />
                                            Ï∂îÍ∞Ä
                                        </button>
                                    </div>

                                    <div className="space-y-6 relative pl-2">
                                        <div className="absolute left-[7px] top-2 bottom-2 w-[2px] bg-gray-200"></div>
                                        
                                        {dayInfo.activities.map((act) => {
                                            const IconComponent = iconMap[act.icon] || MapPin;
                                            return (
                                                <div key={act.id} className="relative pl-8">
                                                    <div className="absolute left-0 top-1 w-4 h-4 rounded-full bg-indigo-100 border-2 border-indigo-500 z-10"></div>
                                                    
                                                    <div className="flex items-start justify-between gap-2">
                                                        <div className="flex-1">
                                                            <span className="inline-block px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-[10px] font-bold mb-1">
                                                                {act.time}
                                                            </span>
                                                            <h4 className="font-bold text-gray-800 text-sm">{act.title}</h4>
                                                            <p className="text-xs text-gray-500 mt-1">{act.desc}</p>
                                                        </div>
                                                        <div className="flex items-center gap-1">
                                                            <div className="text-indigo-400 bg-indigo-50 p-1.5 rounded-lg">
                                                                <IconComponent size={16} />
                                                            </div>
                                                            <button
                                                                onClick={() => {
                                                                    setEditingActivity(act);
                                                                    setEditingDay(dayInfo.id);
                                                                }}
                                                                className="text-gray-400 hover:text-indigo-600 p-1"
                                                            >
                                                                <Edit size={14} />
                                                            </button>
                                                            <button
                                                                onClick={() => handleDeleteActivity(dayInfo.id, act.id)}
                                                                className="text-gray-400 hover:text-red-600 p-1"
                                                            >
                                                                <Trash2 size={14} />
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}
                        </div>
                    ))}

                    {editingDay !== null && (
                        <EditActivityModal
                            activity={editingActivity}
                            onSave={(data) => handleSaveActivity(editingDay, data)}
                            onClose={() => {
                                setEditingActivity(null);
                                setEditingDay(null);
                            }}
                        />
                    )}
                </div>
            );
        };

        // AI Í∞ÄÏù¥Îìú Î∑∞
        const AIGuideView = () => {
            const [messages, setMessages] = useState([
                { id: 1, text: "ÏïàÎÖïÌïòÏÑ∏Ïöî! ÎÇòÍ≥†Ïïº Ïó¨Ìñâ Ï§ë Í∂ÅÍ∏àÌïú Í≤å ÏûàÎÇòÏöî? ÎßõÏßë, ÏáºÌïë, ÍøÄÌåÅ Î≠êÎì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî! üòä", sender: "bot" }
            ]);
            const [inputText, setInputText] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [messages]);

            const handleSend = async (e) => {
                e.preventDefault();
                if (!inputText.trim() || isLoading) return;

                const userMsg = { id: Date.now(), text: inputText, sender: "user" };
                setMessages(prev => [...prev, userMsg]);
                setInputText("");
                setIsLoading(true);

                const aiResponseText = await callGeminiAPI(inputText);
                const botMsg = { id: Date.now() + 1, text: aiResponseText, sender: "bot" };
                setMessages(prev => [...prev, botMsg]);
                setIsLoading(false);
            };

            const suggestedQuestions = [
                "üç§ ÎÇòÍ≥†Ïïº Î™ÖÎ¨º ÏùåÏãù Ï∂îÏ≤úÌï¥Ï§ò",
                "üéÅ ÎèàÌÇ§Ìò∏ÌÖå Ï∂îÏ≤ú ÏáºÌïëÎ¶¨Ïä§Ìä∏",
                "üèôÔ∏è ÏÇ¨Ïπ¥Ïóê Í∑ºÏ≤ò ÏïºÍ≤Ω Î™ÖÏÜåÎäî?",
            ];

            return (
                <div className="flex flex-col h-screen pb-20 pt-14 bg-gray-100">
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {messages.map((msg) => (
                            <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`}>
                                <div className={`flex items-end gap-2 max-w-[80%] ${msg.sender === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${msg.sender === 'user' ? 'bg-indigo-600' : 'bg-white border border-gray-200'}`}>
                                        {msg.sender === 'user' ? <User size={16} /> : <Sparkles size={16} />}
                                    </div>
                                    <div className={`px-4 py-2.5 rounded-2xl text-sm leading-relaxed shadow-sm whitespace-pre-wrap ${
                                        msg.sender === 'user' 
                                        ? 'bg-indigo-600 text-white rounded-br-none' 
                                        : 'bg-white text-gray-800 border border-gray-100 rounded-bl-none'
                                    }`}>
                                        {msg.text}
                                    </div>
                                </div>
                            </div>
                        ))}
                        {isLoading && (
                            <div className="flex justify-start animate-fade-in">
                                <div className="flex items-end gap-2">
                                    <div className="w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center">
                                        <Sparkles size={16} />
                                    </div>
                                    <div className="bg-white px-4 py-3 rounded-2xl rounded-bl-none border border-gray-100 shadow-sm flex gap-1">
                                        <div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                        <div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                        <div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    {messages.length < 3 && (
                        <div className="px-4 py-2 overflow-x-auto whitespace-nowrap hide-scrollbar space-x-2">
                            {suggestedQuestions.map((q, idx) => (
                                <button 
                                    key={idx} 
                                    onClick={() => setInputText(q)}
                                    className="inline-block px-3 py-1.5 bg-white border border-indigo-100 text-indigo-600 rounded-full text-xs font-medium shadow-sm"
                                >
                                    {q}
                                </button>
                            ))}
                        </div>
                    )}

                    <div className="p-3 bg-white border-t border-gray-200 shadow-lg">
                        <form onSubmit={handleSend} className="flex gap-2 relative">
                            <input 
                                type="text" 
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                                placeholder="Î¨¥ÏóáÏù¥Îì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî..." 
                                className="flex-1 bg-gray-100 text-gray-800 text-sm rounded-full px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 pr-10"
                            />
                            <button 
                                type="submit" 
                                disabled={isLoading || !inputText.trim()}
                                className={`absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full ${inputText.trim() ? 'bg-indigo-600 text-white' : 'bg-gray-300 text-gray-500'}`}
                            >
                                <ArrowRight size={16} />
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // Î≤àÏó≠ Î∑∞
        const TranslatorView = () => {
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ja-JP';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                }
            };

            return (
                <div className="pb-20 pt-16 px-4">
                    <div className="bg-white p-4 rounded-xl card-shadow mb-6">
                        <h3 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
                            <Globe size={18} />
                            Ïã§ÏãúÍ∞Ñ Î≤àÏó≠ ÎèÑÍµ¨
                        </h3>
                        <div className="grid grid-cols-2 gap-3">
                            <a href="https://translate.google.com/?sl=ko&tl=ja" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-indigo-600 text-white p-3 rounded-lg font-bold text-sm">
                                Íµ¨Í∏Ä Î≤àÏó≠Í∏∞
                            </a>
                            <a href="https://papago.naver.com/" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-green-500 text-white p-3 rounded-lg font-bold text-sm">
                                ÌååÌååÍ≥†
                            </a>
                        </div>
                    </div>

                    <h3 className="font-bold text-gray-800 mb-3 px-1">ÌïÑÏàò Ïó¨Ìñâ ÌöåÌôî</h3>
                    <div className="grid gap-3">
                        {phrases.map((item, idx) => (
                            <button 
                                key={idx} 
                                onClick={() => speak(item.j)}
                                className="bg-white p-4 rounded-xl card-shadow flex items-center justify-between active:scale-[0.98] transition-transform text-left"
                            >
                                <div>
                                    <div className="font-bold text-gray-800 text-sm">{item.k}</div>
                                    <div className="text-xs text-gray-400 mt-0.5">{item.r}</div>
                                    <div className="text-xs text-indigo-600 mt-1 font-medium">{item.j}</div>
                                </div>
                                <div className="bg-indigo-50 p-2 rounded-full text-indigo-600">
                                    <Volume2 size={20} />
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // ÏßÄÏ∂ú Î∑∞
        const WalletView = () => {
            const [expenses, setExpenses] = useState([]);
            const [newItem, setNewItem] = useState('');
            const [newAmount, setNewAmount] = useState('');
            const [category, setCategory] = useState('ÏãùÎπÑ');
            const [isLoading, setIsLoading] = useState(true);
            const [saveStatus, setSaveStatus] = useState('');
            const EXCHANGE_RATE = 9.1;

            useEffect(() => {
                const loadData = async () => {
                    const loaded = await loadFromStore(STORE_EXPENSES);
                    setExpenses(loaded);
                    setIsLoading(false);
                };
                loadData();
            }, []);

            useEffect(() => {
                if (!isLoading) {
                    const saveData = async () => {
                        setSaveStatus('Ï†ÄÏû• Ï§ë...');
                        await saveToStore(STORE_EXPENSES, expenses);
                        setSaveStatus('‚úì Ï†ÄÏû•Îê®');
                        setTimeout(() => setSaveStatus(''), 1500);
                    };
                    saveData();
                }
            }, [expenses, isLoading]);

            const addExpense = (e) => {
                e.preventDefault();
                if (!newItem || !newAmount) return;
                
                const expense = {
                    id: Date.now(),
                    item: newItem,
                    amount: parseInt(newAmount),
                    category: category,
                    date: new Date().toLocaleDateString('ko-KR')
                };
                
                setExpenses([expense, ...expenses]);
                setNewItem('');
                setNewAmount('');
            };

            const removeExpense = (id) => {
                setExpenses(expenses.filter(ex => ex.id !== id));
            };

            const totalJPY = expenses.reduce((sum, ex) => sum + ex.amount, 0);
            const totalKRW = Math.floor(totalJPY * EXCHANGE_RATE);

            if (isLoading) {
                return (
                    <div className="pb-20 pt-16 px-4 h-full flex items-center justify-center">
                        <div className="text-center">
                            <Database size={48} className="mx-auto text-indigo-600 mb-3 animate-pulse" />
                            <p className="text-gray-500">ÏßÄÏ∂ú ÎÇ¥Ïó≠ Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="pb-20 pt-16 px-4 h-full flex flex-col">
                    <div className="bg-indigo-600 rounded-2xl p-5 text-white shadow-lg mb-6 relative overflow-hidden">
                        <div className="relative z-10">
                            <div className="flex items-center justify-between mb-1">
                                <p className="text-indigo-200 text-sm font-medium">Ï¥ù ÏßÄÏ∂ú Í∏àÏï°</p>
                                {saveStatus && (
                                    <span className="text-xs bg-white/20 px-2 py-1 rounded-full">
                                        {saveStatus}
                                    </span>
                                )}
                            </div>
                            <h2 className="text-3xl font-bold mb-1">¬• {totalJPY.toLocaleString()}</h2>
                            <p className="text-indigo-200 text-sm">‚âà {totalKRW.toLocaleString()} Ïõê</p>
                        </div>
                    </div>

                    <form onSubmit={addExpense} className="bg-white p-4 rounded-xl card-shadow mb-6">
                        <div className="grid grid-cols-3 gap-2 mb-3">
                            {['ÏãùÎπÑ', 'ÏáºÌïë', 'ÍµêÌÜµ', 'ÏàôÎ∞ï', 'Í∏∞ÌÉÄ'].map(cat => (
                                <button 
                                    key={cat}
                                    type="button"
                                    onClick={() => setCategory(cat)}
                                    className={`text-xs py-2 rounded-lg font-medium ${category === cat ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-500'}`}
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>
                        <div className="flex gap-2 mb-3">
                            <input 
                                type="text" 
                                placeholder="ÏÇ¨Ïö© ÎÇ¥Ïó≠" 
                                value={newItem}
                                onChange={(e) => setNewItem(e.target.value)}
                                className="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-indigo-500"
                            />
                            <input 
                                type="number" 
                                placeholder="Í∏àÏï°" 
                                value={newAmount}
                                onChange={(e) => setNewAmount(e.target.value)}
                                className="w-24 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-indigo-500"
                            />
                        </div>
                        <button type="submit" className="w-full bg-indigo-600 text-white py-2.5 rounded-lg text-sm font-bold flex items-center justify-center gap-2">
                            <Plus size={16} />
                            ÏßÄÏ∂ú Ï∂îÍ∞Ä
                        </button>
                    </form>

                    <div className="flex-1 overflow-auto pb-4">
                        <h3 className="font-bold text-gray-800 mb-3 text-sm px-1">ÏßÄÏ∂ú ÎÇ¥Ïó≠</h3>
                        {expenses.length === 0 ? (
                            <div className="text-center py-10 text-gray-400 text-sm bg-white rounded-xl border border-dashed border-gray-200">
                                ÏïÑÏßÅ ÏßÄÏ∂ú ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {expenses.map(ex => {
                                    const IconComponent = ex.category === 'ÏãùÎπÑ' ? Utensils :
                                                         ex.category === 'ÏáºÌïë' ? ShoppingBag :
                                                         ex.category === 'ÍµêÌÜµ' ? Train :
                                                         ex.category === 'ÏàôÎ∞ï' ? Hotel : Coffee;
                                    return (
                                        <div key={ex.id} className="bg-white p-3 rounded-lg shadow-sm flex items-center justify-between border border-gray-100">
                                            <div className="flex items-center gap-3">
                                                <div className={`w-10 h-10 rounded-full flex items-center justify-center
                                                    ${ex.category === 'ÏãùÎπÑ' ? 'bg-orange-100 text-orange-500' : 
                                                      ex.category === 'ÏáºÌïë' ? 'bg-pink-100 text-pink-500' :
                                                      ex.category === 'ÍµêÌÜµ' ? 'bg-blue-100 text-blue-500' : 
                                                      ex.category === 'ÏàôÎ∞ï' ? 'bg-purple-100 text-purple-500' : 'bg-gray-100 text-gray-500'}`}>
                                                    <IconComponent size={16} />
                                                </div>
                                                <div>
                                                    <div className="font-bold text-sm text-gray-800">{ex.item}</div>
                                                    <div className="text-xs text-gray-400">{ex.category} | {ex.date}</div>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-3">
                                                <span className="font-bold text-gray-800">¬•{ex.amount.toLocaleString()}</span>
                                                <button onClick={() => removeExpense(ex.id)} className="text-gray-300 hover:text-red-500 p-1">
                                                    <Trash2 size={16} />
                                                </button>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Î©îÏù∏ Ïï±
        const App = () => {
            const [activeTab, setActiveTab] = useState('itinerary');

            const getTitle = () => {
                switch(activeTab) {
                    case 'itinerary': return 'ÎÇòÍ≥†Ïïº 3Î∞ï 4Ïùº ÏùºÏ†ï';
                    case 'ai-guide': return '‚ú® AI Ïó¨Ìñâ Í∞ÄÏù¥Îìú';
                    case 'translate': return 'Ïó¨Ìñâ Î≤àÏó≠Í∏∞';
                    case 'wallet': return 'Ìä∏ÎûòÎ∏î Í∞ÄÍ≥ÑÎ∂Ä';
                    default: return 'Nagoya Mate';
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 text-gray-900">
                    <Header title={getTitle()} />
                    
                    <main className="max-w-md mx-auto min-h-screen bg-gray-50 relative">
                        {activeTab === 'itinerary' && <ItineraryView />}
                        {activeTab === 'ai-guide' && <AIGuideView />}
                        {activeTab === 'translate' && <TranslatorView />}
                        {activeTab === 'wallet' && <WalletView />}
                    </main>

                    <Navigation activeTab={activeTab} setActiveTab={setActiveTab} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
