<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#4F46E5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ë‚˜ê³ ì•¼">
    <title>ë‚˜ê³ ì•¼ ì—¬í–‰ ë©”ì´íŠ¸</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .card-shadow { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        input[type='number']::-webkit-inner-spin-button, input[type='number']::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Chat Bubble Animation */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .typing-dot { animation: typing 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        /* iOS Safe Area */
        @supports(padding: env(safe-area-inset-bottom)) {
            .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Service Worker ë“±ë¡
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }

        // ========== IndexedDB ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ==========
        const DB_NAME = 'NagoyaTravelDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'expenses';

        // IndexedDB ì´ˆê¸°í™”
        const initDB = () => {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        db.createObjectStore(STORE_NAME, { keyPath: 'id' });
                    }
                };
            });
        };

        // ì§€ì¶œ ë‚´ì—­ ì €ì¥
        const saveExpensesToDB = async (expenses) => {
            try {
                const db = await initDB();
                const transaction = db.transaction([STORE_NAME], 'readwrite');
                const store = transaction.objectStore(STORE_NAME);
                
                // ê¸°ì¡´ ë°ì´í„° ëª¨ë‘ ì‚­ì œ
                store.clear();
                
                // ìƒˆ ë°ì´í„° ì €ì¥
                expenses.forEach(expense => {
                    store.add(expense);
                });
                
                return new Promise((resolve, reject) => {
                    transaction.oncomplete = () => resolve(true);
                    transaction.onerror = () => reject(transaction.error);
                });
            } catch (error) {
                console.error('Failed to save to IndexedDB:', error);
                return false;
            }
        };

        // ì§€ì¶œ ë‚´ì—­ ë¶ˆëŸ¬ì˜¤ê¸°
        const loadExpensesFromDB = async () => {
            try {
                const db = await initDB();
                const transaction = db.transaction([STORE_NAME], 'readonly');
                const store = transaction.objectStore(STORE_NAME);
                const request = store.getAll();
                
                return new Promise((resolve, reject) => {
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            } catch (error) {
                console.error('Failed to load from IndexedDB:', error);
                return [];
            }
        };

        // Lucide Icons (SVG ì§ì ‘ ì‚¬ìš©)
        const Calendar = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>;
        const MapPin = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>;
        const Wallet = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>;
        const Languages = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m5 8 6 6"></path><path d="m4 14 6-6 2-3"></path><path d="M2 5h12"></path><path d="M7 2h1"></path><path d="m22 22-5-10-5 10"></path><path d="M14 18h6"></path></svg>;
        const ChevronDown = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>;
        const ChevronUp = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>;
        const Coffee = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>;
        const Utensils = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path><path d="M7 2v20"></path><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path></svg>;
        const ShoppingBag = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>;
        const Train = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="4" width="16" height="16" rx="2"></rect><path d="M4 11h16"></path><path d="M12 4v7"></path><path d="m8 19-2 3"></path><path d="m18 22-2-3"></path><path d="M8 15h0"></path><path d="M16 15h0"></path></svg>;
        const Hotel = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Z"></path><path d="m9 16 .348-.24c1.465-1.013 3.84-1.013 5.304 0L15 16"></path><path d="M8 7h.01"></path><path d="M16 7h.01"></path><path d="M12 7h.01"></path><path d="M12 11h.01"></path><path d="M16 11h.01"></path><path d="M8 11h.01"></path></svg>;
        const Plus = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const Trash2 = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>;
        const Volume2 = ({size = 20}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path><path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>;
        const ArrowRight = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>;
        const Globe = ({size = 18}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>;
        const Sparkles = ({size = 20, className = ""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>;
        const User = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>;
        const Database = ({size = 16}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;

        // --- Gemini API Logic ---
        const callGeminiAPI = async (userQuery) => {
            // âš ï¸ ì—¬ê¸°ì— ë³¸ì¸ì˜ Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”
            // https://aistudio.google.com/app/apikey ì—ì„œ ë°œê¸‰ ê°€ëŠ¥
            const apiKey = "AIzaSyBn7yNPDQu5KWbrtgLVlvgCwgHQwFUTdBU";
            
            if (!apiKey || apiKey === "YOUR_GEMINI_API_KEY_HERE") {
                return "âš ï¸ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nì½”ë“œì˜ callGeminiAPI í•¨ìˆ˜ì—ì„œ apiKeyë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.\n\nGoogle AI Studio(https://aistudio.google.com/app/apikey)ì—ì„œ ë¬´ë£Œë¡œ ë°œê¸‰ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            }
            
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`;
            
            const systemInstruction = "ë‹¹ì‹ ì€ ë‚˜ê³ ì•¼ ì—¬í–‰ ì „ë¬¸ê°€ ê°€ì´ë“œ 'ë‚˜ê³ ì•¼ ë©”ì´íŠ¸'ì…ë‹ˆë‹¤. í•œêµ­ì¸ ì—¬í–‰ê°ì—ê²Œ ì¹œì ˆí•˜ê³  ìœ ìš©í•œ ì •ë³´ë¥¼ ì œê³µí•˜ì„¸ìš”. ë‹µë³€ì€ ëª¨ë°”ì¼ í™”ë©´ì—ì„œ ë³´ê¸° ì¢‹ê²Œ 3ì¤„ ì´ë‚´ë¡œ í•µì‹¬ë§Œ ìš”ì•½í•´ì„œ ë§í•˜ê³ , í•„ìš”í•˜ë©´ ì´ëª¨ì§€ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. ë§›ì§‘, êµí†µ, ì‡¼í•‘, ê´€ê´‘ì§€ ì¶”ì²œì— íŠ¹í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.";

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            const maxRetries = 3;
            let delay = 1000;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(`API Error: ${response.status} - ${errorData.error?.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                    }

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "ì£„ì†¡í•´ìš”, ë‹µë³€ì„ ìƒì„±í•˜ì§€ ëª»í–ˆì–´ìš”.";
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed:`, error);
                    if (i === maxRetries - 1) {
                        return `ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n${error.message}\n\nì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.`;
                    }
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
        };

        // --- Data: ì¼ì • ë°ì´í„° ---
        const itineraryData = [
            {
                day: 1,
                date: "1ì›” 31ì¼ (ê¸ˆ)",
                title: "ë‚˜ê³ ì•¼ ë„ì°© & ì‚¬ì¹´ì— íƒë°©",
                location: "ë‚˜ê³ ì•¼ ì‹œë‚´",
                activities: [
                    { time: "10:00", title: "ë‚˜ê³ ì•¼ ì£¼ë¶€ ê³µí•­ ë„ì°©", desc: "ë®¤ìŠ¤ì¹´ì´ ì—´ì°¨ íƒ‘ìŠ¹ (ë‚˜ê³ ì•¼ì—­í–‰, ì•½ 28ë¶„)", icon: <Train size={16} /> },
                    { time: "12:00", title: "í˜¸í…” ì²´í¬ì¸ & ì§ ë³´ê´€", desc: "ë‚˜ê³ ì•¼ì—­ ë˜ëŠ” ì‚¬ì¹´ì—ì—­ ê·¼ì²˜ ì¶”ì²œ", icon: <Hotel size={16} /> },
                    { time: "13:00", title: "ì ì‹¬: ë¯¸ì†Œì¹´ì¸ ", desc: "ì•¼ë°”í†¤ ë“± ë‚˜ê³ ì•¼ ëª…ë¬¼ ëœì¥ ëˆê¹ŒìŠ¤", icon: <Utensils size={16} /> },
                    { time: "15:00", title: "ë‚˜ê³ ì•¼ ì„±", desc: "ì²œìˆ˜ê° ë° í˜¼ë§ˆë£¨ì–´ì „ ê´€ëŒ", icon: <MapPin size={16} /> },
                    { time: "18:00", title: "ì‚¬ì¹´ì— ì§€êµ¬", desc: "ì˜¤ì•„ì‹œìŠ¤21 ì•¼ê²½ & ë¯¸ë¼ì´ íƒ€ì›Œ", icon: <ShoppingBag size={16} /> },
                    { time: "20:00", title: "ì €ë…: í…Œë°”ì‚¬í‚¤ & ë§¥ì£¼", desc: "ì„¸ì¹´ì´ë…¸ ì•¼ë§ˆì§± ë‹­ë‚ ê°œ íŠ€ê¹€", icon: <Utensils size={16} /> }
                ]
            },
            {
                day: 2,
                date: "2ì›” 1ì¼ (í† )",
                title: "ê·¼êµ ì—¬í–‰: ë‹¤ì¹´ì•¼ë§ˆ & ê²Œë¡œ",
                location: "ë‹¤ì¹´ì•¼ë§ˆ / ê²Œë¡œ",
                activities: [
                    { time: "08:00", title: "íˆë‹¤ ì™€ì´ë“œë·° ì—´ì°¨ íƒ‘ìŠ¹", desc: "ë‚˜ê³ ì•¼ì—­ -> ë‹¤ì¹´ì•¼ë§ˆì—­ (ì•½ 2ì‹œê°„ 20ë¶„)", icon: <Train size={16} /> },
                    { time: "11:00", title: "ë‹¤ì¹´ì•¼ë§ˆ ì˜›ê±°ë¦¬ (ì‚°ë§ˆì¹˜)", desc: "ì‘ì€ êµí† ë¼ ë¶ˆë¦¬ëŠ” ê±°ë¦¬ ì‚°ì±…", icon: <MapPin size={16} /> },
                    { time: "12:30", title: "ì ì‹¬: íˆë‹¤ê·œ ìŠ¤ì‹œ/êµ¬ì´", desc: "ì…ì—ì„œ ë…¹ëŠ” ì†Œê³ ê¸° ìš”ë¦¬", icon: <Utensils size={16} /> },
                    { time: "15:00", title: "ê²Œë¡œ ì˜¨ì²œìœ¼ë¡œ ì´ë™", desc: "JR ì—´ì°¨ë¡œ ì•½ 45ë¶„ ì´ë™", icon: <Train size={16} /> },
                    { time: "17:00", title: "ë£Œì¹¸ ì²´í¬ì¸ & ì˜¨ì²œ", desc: "ì¼ë³¸ 3ëŒ€ ì˜¨ì²œ ì¦ê¸°ê¸°", icon: <Hotel size={16} /> },
                    { time: "19:00", title: "ê°€ì´ì„¸í‚¤ ì„ì‹", desc: "ë£Œì¹¸ ë‚´ ì €ë… ì‹ì‚¬", icon: <Utensils size={16} /> }
                ]
            },
            {
                day: 3,
                date: "2ì›” 2ì¼ (ì¼)",
                title: "ë‚˜ê³ ì•¼ ë³µê·€ & ì˜¤ìŠ¤ ìƒì ê°€",
                location: "ê²Œë¡œ / ë‚˜ê³ ì•¼",
                activities: [
                    { time: "09:00", title: "ì¡°ì‹ í›„ ì²´í¬ì•„ì›ƒ", desc: "ê²Œë¡œ ì˜¨ì²œë§ˆì„ ì‚°ì±… ë° ì¡±ìš•", icon: <Coffee size={16} /> },
                    { time: "11:00", title: "ë‚˜ê³ ì•¼í–‰ ì—´ì°¨ íƒ‘ìŠ¹", desc: "ë‚˜ê³ ì•¼ì—­ ë³µê·€ (ì•½ 1ì‹œê°„ 40ë¶„)", icon: <Train size={16} /> },
                    { time: "13:30", title: "ì ì‹¬: íˆì¸ ë§ˆë¶€ì‹œ", desc: "ì•„ì¸ íƒ€ í˜¸ë¼ì´ì¼„ ë“± ì¥ì–´ë®ë°¥", icon: <Utensils size={16} /> },
                    { time: "15:30", title: "ì˜¤ìŠ¤ ì¹¸ë…¼ & ìƒì ê°€", desc: "ë¹ˆí‹°ì§€ ìƒµ, ê¸¸ê±°ë¦¬ ìŒì‹ íƒë°©", icon: <ShoppingBag size={16} /> },
                    { time: "19:00", title: "ë‚˜ê³ ì•¼ì—­ ì£¼ë³€ ì‡¼í•‘", desc: "ë‹¤ì¹´ì‹œë§ˆì•¼ ë°±í™”ì , ë“œëŸ­ìŠ¤í† ì–´", icon: <ShoppingBag size={16} /> }
                ]
            },
            {
                day: 4,
                date: "2ì›” 3ì¼ (ì›”)",
                title: "ëª¨ë‹ & ê·€êµ­",
                location: "ë‚˜ê³ ì•¼",
                activities: [
                    { time: "09:00", title: "ë‚˜ê³ ì•¼ ëª¨ë‹", desc: "ì½”ë©”ë‹¤ ì»¤í”¼ì—ì„œ ìŒë£Œ ì£¼ë¬¸ì‹œ í† ìŠ¤íŠ¸ ë¬´ë£Œ", icon: <Coffee size={16} /> },
                    { time: "11:00", title: "ë…¸ë¦¬íƒ€ì¼€ì˜ ìˆ²", desc: "ë„ìê¸° ì •ì› ì‚°ì±… ë° ê¸°ë…í’ˆ", icon: <MapPin size={16} /> },
                    { time: "13:00", title: "ê³µí•­ìœ¼ë¡œ ì´ë™", desc: "ë¹„í–‰ê¸° ì‹œê°„ì— ë§ì¶° ë®¤ìŠ¤ì¹´ì´ íƒ‘ìŠ¹", icon: <Train size={16} /> },
                    { time: "15:00", title: "ë©´ì„¸ì  ì‡¼í•‘ & ì¶œêµ­", desc: "ë¡œì´ì¦ˆ ì´ˆì½œë¦¿, ë„ì¿„ ë°”ë‚˜ë‚˜ ë“±", icon: <ShoppingBag size={16} /> }
                ]
            }
        ];

        // --- Data: íšŒí™” ë°ì´í„° ---
        const phrases = [
            { k: "ì•ˆë…•í•˜ì„¸ìš”", j: "ã“ã‚“ã«ã¡ã¯", r: "ê³¤ë‹ˆì°Œì™€" },
            { k: "ê°ì‚¬í•©ë‹ˆë‹¤", j: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", r: "ì•„ë¦¬ê°€ë˜-ê³ ìì´ë§ˆìŠ¤" },
            { k: "í™”ì¥ì‹¤ì€ ì–´ë””ì¸ê°€ìš”?", j: "ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ", r: "í† ì´ë ˆì™€ ë„ì½”ë°ìŠ¤ê¹Œ?" },
            { k: "ì´ê²ƒì€ ì–¼ë§ˆì…ë‹ˆê¹Œ?", j: "ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹ï¼Ÿ", r: "ê³ ë ˆì™€ ì´ì¿ ë¼ë°ìŠ¤ê¹Œ?" },
            { k: "ì£¼ë¬¸ ë¶€íƒí•©ë‹ˆë‹¤", j: "æ³¨æ–‡ã‚’ãŠé¡˜ã„ã—ã¾ã™", r: "ì¶”-ëª¬ì˜¤ ì˜¤ë„¤ê°€ì´ì‹œë§ˆìŠ¤" },
            { k: "ê³„ì‚°í•´ ì£¼ì„¸ìš”", j: "ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™", r: "ì˜¤ì¹´ì´ì¼€-ì˜¤ ì˜¤ë„¤ê°€ì´ì‹œë§ˆìŠ¤" },
            { k: "ì‚¬ì§„ì„ ì°ì–´ ì£¼ì‹œê² ì–´ìš”?", j: "å†™çœŸã‚’æ’®ã£ã¦ã‚‚ã‚‰ãˆã¾ã›ã‚“ã‹ï¼Ÿ", r: "ìƒ¤ì‹±ì˜¤ í†³í…Œ ëª¨ë¼ì—ë§ˆì…ê¹Œ?" },
            { k: "í•œêµ­ì–´ ë©”ë‰´íŒ ìˆë‚˜ìš”?", j: "éŸ“å›½èªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ", r: "ìº‰ì½”ì¿ ê³ ë…¸ ë©”ë‰´-ì™€ ì•„ë¦¬ë§ˆìŠ¤ê¹Œ?" },
            { k: "ì¹´ë“œ ê²°ì œ ë˜ë‚˜ìš”?", j: "ã‚«ãƒ¼ãƒ‰ã¯ä½¿ãˆã¾ã™ã‹ï¼Ÿ", r: "ì¹´-ë„ì™€ ì¸ ì¹´ì—ë§ˆìŠ¤ê¹Œ?" },
            { k: "ë¬¼ ì¢€ ì£¼ì„¸ìš”", j: "ãŠæ°´ã‚’ãã ã•ã„", r: "ì˜¤ë¯¸ì¦ˆì˜¤ ì¿ ë‹¤ì‚¬ì´" },
        ];

        // --- Components ---

        const Navigation = ({ activeTab, setActiveTab }) => (
            <nav className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 pb-safe z-50 h-16 flex justify-around items-center shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)]">
                <button onClick={() => setActiveTab('itinerary')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'itinerary' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <Calendar />
                    <span className="text-[10px] mt-1 font-medium">ì¼ì •</span>
                </button>
                <button onClick={() => setActiveTab('ai-guide')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'ai-guide' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <div className={`relative flex items-center justify-center ${activeTab === 'ai-guide' ? 'text-indigo-600' : 'text-gray-400'}`}>
                        <Sparkles size={20} className={activeTab === 'ai-guide' ? 'fill-indigo-100' : ''} />
                        <span className="absolute -top-1 -right-1 flex h-2 w-2">
                          <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span>
                          <span className="relative inline-flex rounded-full h-2 w-2 bg-indigo-500"></span>
                        </span>
                    </div>
                    <span className="text-[10px] mt-1 font-medium">AI ê°€ì´ë“œ</span>
                </button>
                <button onClick={() => setActiveTab('translate')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'translate' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <Languages />
                    <span className="text-[10px] mt-1 font-medium">ë²ˆì—­</span>
                </button>
                <button onClick={() => setActiveTab('wallet')} className={`flex flex-col items-center justify-center w-full h-full ${activeTab === 'wallet' ? 'text-indigo-600' : 'text-gray-400'}`}>
                    <Wallet />
                    <span className="text-[10px] mt-1 font-medium">ì§€ì¶œ</span>
                </button>
            </nav>
        );

        const Header = ({ title }) => (
            <header className="fixed top-0 left-0 right-0 bg-indigo-600 text-white h-14 flex items-center justify-center px-4 z-50 shadow-md transition-colors duration-300">
                <h1 className="text-lg font-bold tracking-wide">{title}</h1>
            </header>
        );

        const ItineraryView = () => {
            const [expandedDay, setExpandedDay] = useState(1);

            const toggleDay = (day) => {
                setExpandedDay(expandedDay === day ? null : day);
            };

            return (
                <div className="pb-20 pt-16 px-4 space-y-4">
                    {itineraryData.map((dayInfo) => (
                        <div key={dayInfo.day} className="bg-white rounded-xl overflow-hidden card-shadow transition-all duration-300">
                            <button 
                                onClick={() => toggleDay(dayInfo.day)}
                                className={`w-full flex items-center justify-between p-4 ${expandedDay === dayInfo.day ? 'bg-indigo-50' : 'bg-white'}`}
                            >
                                <div className="flex items-center gap-3">
                                    <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold ${expandedDay === dayInfo.day ? 'bg-indigo-600' : 'bg-gray-400'}`}>
                                        Day {dayInfo.day}
                                    </div>
                                    <div className="text-left">
                                        <div className="font-bold text-gray-800">{dayInfo.date}</div>
                                        <div className="text-xs text-gray-500">{dayInfo.location}</div>
                                    </div>
                                </div>
                                {expandedDay === dayInfo.day ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                            </button>
                            
                            {expandedDay === dayInfo.day && (
                                <div className="p-4 border-t border-gray-100 bg-white">
                                    <h3 className="font-bold text-indigo-800 mb-4 text-sm">{dayInfo.title}</h3>
                                    <div className="space-y-6 relative pl-2">
                                        <div className="absolute left-[7px] top-2 bottom-2 w-[2px] bg-gray-200"></div>
                                        
                                        {dayInfo.activities.map((act, idx) => (
                                            <div key={idx} className="relative pl-8">
                                                <div className="absolute left-0 top-1 w-4 h-4 rounded-full bg-indigo-100 border-2 border-indigo-500 z-10"></div>
                                                
                                                <div className="flex items-start justify-between">
                                                    <div>
                                                        <span className="inline-block px-2 py-0.5 bg-gray-100 text-gray-600 rounded text-[10px] font-bold mb-1">
                                                            {act.time}
                                                        </span>
                                                        <h4 className="font-bold text-gray-800 text-sm">{act.title}</h4>
                                                        <p className="text-xs text-gray-500 mt-1 leading-relaxed">{act.desc}</p>
                                                    </div>
                                                    <div className="text-indigo-400 bg-indigo-50 p-1.5 rounded-lg">
                                                        {act.icon}
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    ))}
                    <div className="text-center text-xs text-gray-400 mt-6 mb-2">
                        ì¦ê±°ìš´ ë‚˜ê³ ì•¼ ì—¬í–‰ ë˜ì„¸ìš”! âœˆï¸
                    </div>
                </div>
            );
        };

        const AIGuideView = () => {
            const [messages, setMessages] = useState([
                { id: 1, text: "ì•ˆë…•í•˜ì„¸ìš”! ë‚˜ê³ ì•¼ ì—¬í–‰ ì¤‘ ê¶ê¸ˆí•œ ê²Œ ìˆë‚˜ìš”? ë§›ì§‘, ì‡¼í•‘, ê¿€íŒ ë­ë“  ë¬¼ì–´ë³´ì„¸ìš”! ğŸ˜Š", sender: "bot" }
            ]);
            const [inputText, setInputText] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            const handleSend = async (e) => {
                e.preventDefault();
                if (!inputText.trim() || isLoading) return;

                const userMsg = { id: Date.now(), text: inputText, sender: "user" };
                setMessages(prev => [...prev, userMsg]);
                setInputText("");
                setIsLoading(true);

                try {
                    const aiResponseText = await callGeminiAPI(inputText);
                    const botMsg = { id: Date.now() + 1, text: aiResponseText, sender: "bot" };
                    setMessages(prev => [...prev, botMsg]);
                } catch (error) {
                    const errorMsg = { id: Date.now() + 1, text: "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", sender: "bot" };
                    setMessages(prev => [...prev, errorMsg]);
                } finally {
                    setIsLoading(false);
                }
            };

            const suggestedQuestions = [
                "ğŸ¤ ë‚˜ê³ ì•¼ ëª…ë¬¼ ìŒì‹ ì¶”ì²œí•´ì¤˜",
                "ğŸ ëˆí‚¤í˜¸í…Œ ì¶”ì²œ ì‡¼í•‘ë¦¬ìŠ¤íŠ¸",
                "ğŸ™ï¸ ì‚¬ì¹´ì— ê·¼ì²˜ ì•¼ê²½ ëª…ì†ŒëŠ”?",
                "ğŸµ ë‹¤ì¹´ì•¼ë§ˆì—ì„œ ê¼­ ë¨¹ì–´ì•¼ í•  ê²ƒ"
            ];

            return (
                <div className="flex flex-col h-screen pb-20 pt-14 bg-gray-100">
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {messages.map((msg) => (
                            <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'} animate-fade-in`}>
                                <div className={`flex items-end gap-2 max-w-[80%] ${msg.sender === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                                    <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${msg.sender === 'user' ? 'bg-indigo-600' : 'bg-white border border-gray-200'}`}>
                                        {msg.sender === 'user' ? <User size={16} /> : <Sparkles size={16} />}
                                    </div>
                                    <div className={`px-4 py-2.5 rounded-2xl text-sm leading-relaxed shadow-sm whitespace-pre-wrap ${
                                        msg.sender === 'user' 
                                        ? 'bg-indigo-600 text-white rounded-br-none' 
                                        : 'bg-white text-gray-800 border border-gray-100 rounded-bl-none'
                                    }`}>
                                        {msg.text}
                                    </div>
                                </div>
                            </div>
                        ))}
                        {isLoading && (
                            <div className="flex justify-start animate-fade-in">
                                <div className="flex items-end gap-2">
                                    <div className="w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center">
                                        <Sparkles size={16} />
                                    </div>
                                    <div className="bg-white px-4 py-3 rounded-2xl rounded-bl-none border border-gray-100 shadow-sm flex gap-1">
                                        <div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                        <div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                        <div className="w-1.5 h-1.5 bg-gray-400 rounded-full typing-dot"></div>
                                    </div>
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    {messages.length < 3 && (
                        <div className="px-4 py-2 overflow-x-auto whitespace-nowrap hide-scrollbar space-x-2">
                            {suggestedQuestions.map((q, idx) => (
                                <button 
                                    key={idx} 
                                    onClick={() => setInputText(q)}
                                    className="inline-block px-3 py-1.5 bg-white border border-indigo-100 text-indigo-600 rounded-full text-xs font-medium shadow-sm active:scale-95 transition-transform"
                                >
                                    {q}
                                </button>
                            ))}
                        </div>
                    )}

                    <div className="p-3 bg-white border-t border-gray-200 shadow-lg">
                        <form onSubmit={handleSend} className="flex gap-2 relative">
                            <input 
                                type="text" 
                                value={inputText}
                                onChange={(e) => setInputText(e.target.value)}
                                placeholder="ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”..." 
                                className="flex-1 bg-gray-100 text-gray-800 text-sm rounded-full px-4 py-3 focus:outline-none focus:ring-2 focus:ring-indigo-500 pr-10"
                            />
                            <button 
                                type="submit" 
                                disabled={isLoading || !inputText.trim()}
                                className={`absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 flex items-center justify-center rounded-full transition-colors ${inputText.trim() ? 'bg-indigo-600 text-white' : 'bg-gray-300 text-gray-500'}`}
                            >
                                <ArrowRight size={16} />
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const TranslatorView = () => {
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ja-JP';
                    utterance.rate = 0.9;
                    window.speechSynthesis.speak(utterance);
                } else {
                    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¬ìƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                }
            };

            return (
                <div className="pb-20 pt-16 px-4">
                    <div className="bg-white p-4 rounded-xl card-shadow mb-6">
                        <h3 className="font-bold text-gray-800 mb-3 flex items-center gap-2">
                            <Globe size={18} />
                            ì‹¤ì‹œê°„ ë²ˆì—­ ë„êµ¬
                        </h3>
                        <div className="grid grid-cols-2 gap-3">
                            <a href="https://translate.google.com/?sl=ko&tl=ja" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-indigo-600 text-white p-3 rounded-lg font-bold text-sm hover:bg-indigo-700 transition-colors">
                                êµ¬ê¸€ ë²ˆì—­ê¸° ì—´ê¸°
                            </a>
                            <a href="https://papago.naver.com/" target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 bg-green-500 text-white p-3 rounded-lg font-bold text-sm hover:bg-green-600 transition-colors">
                                íŒŒíŒŒê³  ì—´ê¸°
                            </a>
                        </div>
                    </div>

                    <h3 className="font-bold text-gray-800 mb-3 px-1">í•„ìˆ˜ ì—¬í–‰ íšŒí™”</h3>
                    <div className="grid gap-3">
                        {phrases.map((item, idx) => (
                            <button 
                                key={idx} 
                                onClick={() => speak(item.j)}
                                className="bg-white p-4 rounded-xl card-shadow flex items-center justify-between active:scale-[0.98] transition-transform text-left"
                            >
                                <div>
                                    <div className="font-bold text-gray-800 text-sm">{item.k}</div>
                                    <div className="text-xs text-gray-400 mt-0.5">{item.r}</div>
                                    <div className="text-xs text-indigo-600 mt-1 font-medium">{item.j}</div>
                                </div>
                                <div className="bg-indigo-50 p-2 rounded-full text-indigo-600">
                                    <Volume2 size={20} />
                                </div>
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const WalletView = () => {
            const [expenses, setExpenses] = useState([]);
            const [newItem, setNewItem] = useState('');
            const [newAmount, setNewAmount] = useState('');
            const [category, setCategory] = useState('ì‹ë¹„');
            const [isLoading, setIsLoading] = useState(true);
            const [saveStatus, setSaveStatus] = useState(''); // ì €ì¥ ìƒíƒœ í‘œì‹œ
            const EXCHANGE_RATE = 9.1;

            // ì•± ì‹œì‘ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
            useEffect(() => {
                const loadData = async () => {
                    const loadedExpenses = await loadExpensesFromDB();
                    setExpenses(loadedExpenses);
                    setIsLoading(false);
                };
                loadData();
            }, []);

            // expenses ë³€ê²½ë  ë•Œë§ˆë‹¤ ìë™ ì €ì¥
            useEffect(() => {
                if (!isLoading && expenses.length >= 0) {
                    const saveData = async () => {
                        setSaveStatus('ì €ì¥ ì¤‘...');
                        const success = await saveExpensesToDB(expenses);
                        if (success) {
                            setSaveStatus('âœ“ ì €ì¥ë¨');
                            setTimeout(() => setSaveStatus(''), 1500);
                        } else {
                            setSaveStatus('âš  ì €ì¥ ì‹¤íŒ¨');
                        }
                    };
                    saveData();
                }
            }, [expenses, isLoading]);

            const addExpense = (e) => {
                e.preventDefault();
                if (!newItem || !newAmount) return;
                
                const expense = {
                    id: Date.now(),
                    item: newItem,
                    amount: parseInt(newAmount),
                    category: category,
                    date: new Date().toLocaleDateString('ko-KR')
                };
                
                setExpenses([expense, ...expenses]);
                setNewItem('');
                setNewAmount('');
            };

            const removeExpense = (id) => {
                setExpenses(expenses.filter(ex => ex.id !== id));
            };

            const totalJPY = expenses.reduce((sum, ex) => sum + ex.amount, 0);
            const totalKRW = Math.floor(totalJPY * EXCHANGE_RATE);

            if (isLoading) {
                return (
                    <div className="pb-20 pt-16 px-4 h-full flex items-center justify-center">
                        <div className="text-center">
                            <Database size={48} className="mx-auto text-indigo-600 mb-3 animate-pulse" />
                            <p className="text-gray-500">ì§€ì¶œ ë‚´ì—­ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="pb-20 pt-16 px-4 h-full flex flex-col">
                    <div className="bg-indigo-600 rounded-2xl p-5 text-white shadow-lg mb-6 relative overflow-hidden">
                        <div className="absolute top-0 right-0 opacity-10 transform translate-x-4 -translate-y-4">
                            <Wallet />
                        </div>
                        <div className="relative z-10">
                            <div className="flex items-center justify-between mb-1">
                                <p className="text-indigo-200 text-sm font-medium">ì´ ì§€ì¶œ ê¸ˆì•¡</p>
                                {saveStatus && (
                                    <span className="text-xs bg-white/20 px-2 py-1 rounded-full flex items-center gap-1">
                                        <Database size={12} />
                                        {saveStatus}
                                    </span>
                                )}
                            </div>
                            <h2 className="text-3xl font-bold mb-1">Â¥ {totalJPY.toLocaleString()}</h2>
                            <p className="text-indigo-200 text-sm">â‰ˆ {totalKRW.toLocaleString()} ì›</p>
                        </div>
                    </div>

                    {/* ì˜êµ¬ ì €ì¥ ì•ˆë‚´ */}
                    <div className="bg-green-50 border border-green-200 rounded-lg p-3 mb-4 flex items-start gap-2">
                        <Database size={16} className="text-green-600 mt-0.5 flex-shrink-0" />
                        <div className="text-xs text-green-700">
                            <strong>ìë™ ì €ì¥ í™œì„±í™”!</strong>
                            <br/>ì§€ì¶œ ë‚´ì—­ì´ ìë™ìœ¼ë¡œ ì €ì¥ë˜ì–´ ì•±ì„ ë‹«ì•„ë„ ìœ ì§€ë©ë‹ˆë‹¤.
                        </div>
                    </div>

                    <form onSubmit={addExpense} className="bg-white p-4 rounded-xl card-shadow mb-6">
                        <div className="grid grid-cols-3 gap-2 mb-3">
                            {['ì‹ë¹„', 'ì‡¼í•‘', 'êµí†µ', 'ìˆ™ë°•', 'ê¸°íƒ€'].map(cat => (
                                <button 
                                    key={cat}
                                    type="button"
                                    onClick={() => setCategory(cat)}
                                    className={`text-xs py-2 rounded-lg font-medium transition-colors ${category === cat ? 'bg-indigo-600 text-white' : 'bg-gray-100 text-gray-500'}`}
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>
                        <div className="flex gap-2 mb-3">
                            <input 
                                type="text" 
                                placeholder="ì‚¬ìš© ë‚´ì—­ (ì˜ˆ: í¸ì˜ì )" 
                                value={newItem}
                                onChange={(e) => setNewItem(e.target.value)}
                                className="flex-1 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-indigo-500"
                            />
                            <input 
                                type="number" 
                                placeholder="ê¸ˆì•¡ (ì—”)" 
                                value={newAmount}
                                onChange={(e) => setNewAmount(e.target.value)}
                                className="w-24 bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-indigo-500"
                            />
                        </div>
                        <button type="submit" className="w-full bg-indigo-600 text-white py-2.5 rounded-lg text-sm font-bold flex items-center justify-center gap-2 active:bg-indigo-700">
                            <Plus size={16} />
                            ì§€ì¶œ ì¶”ê°€
                        </button>
                    </form>

                    <div className="flex-1 overflow-auto pb-4">
                        <h3 className="font-bold text-gray-800 mb-3 text-sm px-1">ì§€ì¶œ ë‚´ì—­</h3>
                        {expenses.length === 0 ? (
                            <div className="text-center py-10 text-gray-400 text-sm bg-white rounded-xl border border-dashed border-gray-200">
                                ì•„ì§ ì§€ì¶œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.
                            </div>
                        ) : (
                            <div className="space-y-2">
                                {expenses.map(ex => (
                                    <div key={ex.id} className="bg-white p-3 rounded-lg shadow-sm flex items-center justify-between border border-gray-100">
                                        <div className="flex items-center gap-3">
                                            <div className={`w-10 h-10 rounded-full flex items-center justify-center text-lg
                                                ${ex.category === 'ì‹ë¹„' ? 'bg-orange-100 text-orange-500' : 
                                                  ex.category === 'ì‡¼í•‘' ? 'bg-pink-100 text-pink-500' :
                                                  ex.category === 'êµí†µ' ? 'bg-blue-100 text-blue-500' : 
                                                  ex.category === 'ìˆ™ë°•' ? 'bg-purple-100 text-purple-500' : 'bg-gray-100 text-gray-500'}`}>
                                                {ex.category === 'ì‹ë¹„' ? <Utensils size={16} /> : 
                                                 ex.category === 'ì‡¼í•‘' ? <ShoppingBag size={16} /> :
                                                 ex.category === 'êµí†µ' ? <Train size={16} /> :
                                                 ex.category === 'ìˆ™ë°•' ? <Hotel size={16} /> : <Coffee size={16} />}
                                            </div>
                                            <div>
                                                <div className="font-bold text-sm text-gray-800">{ex.item}</div>
                                                <div className="text-xs text-gray-400">{ex.category} | {ex.date}</div>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3">
                                            <span className="font-bold text-gray-800">Â¥{ex.amount.toLocaleString()}</span>
                                            <button onClick={() => removeExpense(ex.id)} className="text-gray-300 hover:text-red-500 p-1">
                                                <Trash2 size={16} />
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('itinerary');

            const getTitle = () => {
                switch(activeTab) {
                    case 'itinerary': return 'ë‚˜ê³ ì•¼ 3ë°• 4ì¼ ì¼ì •';
                    case 'ai-guide': return 'âœ¨ AI ì—¬í–‰ ê°€ì´ë“œ';
                    case 'translate': return 'ì—¬í–‰ ë²ˆì—­ê¸°';
                    case 'wallet': return 'íŠ¸ë˜ë¸” ê°€ê³„ë¶€';
                    default: return 'Nagoya Mate';
                }
            };

            return (
                <div className="min-h-screen bg-gray-50 text-gray-900">
                    <Header title={getTitle()} />
                    
                    <main className="max-w-md mx-auto min-h-screen bg-gray-50 relative">
                        {activeTab === 'itinerary' && <ItineraryView />}
                        {activeTab === 'ai-guide' && <AIGuideView />}
                        {activeTab === 'translate' && <TranslatorView />}
                        {activeTab === 'wallet' && <WalletView />}
                    </main>

                    <Navigation activeTab={activeTab} setActiveTab={setActiveTab} />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
